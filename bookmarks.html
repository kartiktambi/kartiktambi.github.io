<!DOCTYPE html>
<html>
<head>
  <title>Double Decode and GET Request</title>
  <script>
    function doubleDecodeNumber(doubleEncodedNumber) {
      const base64Decoded = atob(doubleEncodedNumber);
      const base64DecodedAgain = atob(base64Decoded);
      const dividedNumber = parseFloat(base64DecodedAgain) / 2;
      return dividedNumber;
    }

    function cleanUpResponse(rawResponse) {
      const startIndex = rawResponse.indexOf('google.visualization.Query.setResponse(') + 'google.visualization.Query.setResponse('.length;
      const endIndex = rawResponse.lastIndexOf(');');
      const jsonResponse = rawResponse.substring(startIndex, endIndex);
      return jsonResponse;
    }

    function formatListToText(list) {
      return list.join(' OR ');
    }

    function extractValuesFromJSON(jsonResponse) {
      const parsedResponse = JSON.parse(jsonResponse);
      const rows = parsedResponse.table.rows;

      let extractedValues = '';

      for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        const value1 = row.c[0].f;
        const value2 = row.c[1].v;
        const value3 = row.c[2].v;
        const value4 = row.c[3].v;
        const value5 = row.c[4].v;
        const value6 = row.c[5].v;
        const value7 = row.c[6].v;

        extractedValues += `${value1}\n${value2}\n${value3}\n${value4}\n${value5}\n${value6}\n${value7}\n\n`;
      }

      return extractedValues;
    }

    function getRequest() {
      // Get the URL parameter
      const urlParams = new URLSearchParams(window.location.search);
      const encodedNumber = urlParams.get('number');

      // Decode the double-encoded number
      const decodedNumber = doubleDecodeNumber(encodedNumber);

      // Create the GET request URL with the decoded number
      const requestUrl = `https://docs.google.com/spreadsheets/d/1RC_QUIUBf7juTngdPFlC73wo9w2A6HZwl4CpVO1A-ew/gviz/tq?tq=SELECT%20W%20WHERE%20D%20MATCHES%20'${decodedNumber}'`;

      // Make the GET request
      fetch(requestUrl)
        .then(response => response.text())
        .then(data => {
          // Clean up the raw response
          const cleanedResponse = cleanUpResponse(data);

          // Extract the values from the JSON
          const extractedValues = extractValuesFromJSON(cleanedResponse);

          // Display the extracted values in the label
          const responseLabel = document.getElementById('response-label');
          responseLabel.innerText = extractedValues;
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }
  </script>
</head>
<body onload="getRequest()">
  <h1>Double Decode and GET Request</h1>
  <label id="response-label"></label>
</body>
</html>
