<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code URL</title>
</head>
<body>
    <label id="qrUrl"></label>

    <script>
    var ThunkableWebviewerExtension = (function () {
      const postMessageToWebview = (message) => {
        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(message);
        } else {
          window.parent.postMessage(message, '*');
        }
      };
    
      const getReceiveMessageCallback = (fxn, hasReturnValue) => (event) => {
        if (typeof fxn === 'function') {
          if (event.data) {
            let dataObject;
            try {
              dataObject = JSON.parse(event.data);
            } catch (e) {
              // message is not valid json
            }
            if (dataObject && dataObject.type === 'ThunkablePostMessage' && hasReturnValue) {
              fxn(dataObject.message, (returnValue) => {
                const returnMessageObject = { type: 'ThunkablePostMessageReturnValue', uuid: dataObject.uuid, returnValue };
                postMessageToWebview(JSON.stringify(returnMessageObject));
              });
            } else if (!hasReturnValue && (!dataObject || dataObject.type !== 'ThunkablePostMessage')) {
              fxn(event.data);
            }
          }
        }
      };
    
      return {
        postMessage: postMessageToWebview,
        receiveMessage: function(fxn) {
          const callbackFunction = getReceiveMessageCallback(fxn, false);
          document.addEventListener('message', callbackFunction, false);
          window.addEventListener('message', callbackFunction, false);
        },
        receiveMessageWithReturnValue: function(fxn) {
          const callbackFunction = getReceiveMessageCallback(fxn, true);
          document.addEventListener('message', callbackFunction, false);
          window.addEventListener('message', callbackFunction, false);
        },
      };
    })();
    </script>
    
    <script>
        ThunkableWebviewerExtension.receiveMessage(function(message) {
            var id = message;
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${id}`;
            ThunkableWebviewerExtension.postMessage(qrCodeUrl);
            console.log(qrCodeUrl);
        });
    </script>
</body>
</html>
