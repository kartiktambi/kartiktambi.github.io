<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Responsive Image Upload</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f9f9f9;
    }

    .container {
      text-align: center;
      width: 90%;
      max-width: 400px;
    }

    .instructions {
      max-width: 100%;
      margin-bottom: 20px;
      display: block;
    }

    .upload-button {
      display: inline-block;
      padding: 15px 30px;
      background-color: #4caf50;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 20px;
    }

    .upload-button:hover {
      background-color: #45a049;
    }

    .upload-button input {
      display: none;
    }

    .image-preview {
      max-width: 100%;
      max-height: 300px;
      margin: 20px 0;
      border: 1px solid #ddd;
      border-radius: 10px;
    }

    .thank-you {
      font-size: 20px;
      font-weight: bold;
      margin: 20px 0 10px;
    }

    .share-button {
      display: inline-block;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .share-button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://res.cloudinary.com/lalittambi/image/upload/v1736611549/sm7_instructions.png" alt="Instructions" id="instructions" class="instructions">
    <label class="upload-button" id="upload-label">
      Click to Upload or Capture Image
      <input type="file" id="file-input" accept="image/*">
    </label>
    <div>
      <img id="image-preview" class="image-preview" src="" alt="" style="display: none;">
    </div>
    <div id="thank-you-section" style="display: none;">
      <p class="thank-you">Thank you! Tag us on social media.</p>
      <button id="share-button" class="share-button">Share on Social Media</button>
    </div>
  </div>

  <script type="text/javascript">
    function SHA1(msg) {
      function rotate_left(n,s) {
       var t4 = ( n<<s ) | (n>>>(32-s));
       return t4;
       };
       function lsb_hex(val) {
       var str='';
       var i;
       var vh;
       var vl;
       for( i=0; i<=6; i+=2 ) {
       vh = (val>>>(i*4+4))&0x0f;
       vl = (val>>>(i*4))&0x0f;
       str += vh.toString(16) + vl.toString(16);
       }
       return str;
       };
       function cvt_hex(val) {
       var str='';
       var i;
       var v;
       for( i=7; i>=0; i-- ) {
       v = (val>>>(i*4))&0x0f;
       str += v.toString(16);
       }
       return str;
       };
       function Utf8Encode(string) {
       string = string.replace(/\r\n/g,'\n');
       var utftext = '';
       for (var n = 0; n < string.length; n++) {
       var c = string.charCodeAt(n);
       if (c < 128) {
       utftext += String.fromCharCode(c);
       }
       else if((c > 127) && (c < 2048)) {
       utftext += String.fromCharCode((c >> 6) | 192);
       utftext += String.fromCharCode((c & 63) | 128);
       }
       else {
       utftext += String.fromCharCode((c >> 12) | 224);
       utftext += String.fromCharCode(((c >> 6) & 63) | 128);
       utftext += String.fromCharCode((c & 63) | 128);
       }
       }
       return utftext;
       };
       var blockstart;
       var i, j;
       var W = new Array(80);
       var H0 = 0x67452301;
       var H1 = 0xEFCDAB89;
       var H2 = 0x98BADCFE;
       var H3 = 0x10325476;
       var H4 = 0xC3D2E1F0;
       var A, B, C, D, E;
       var temp;
       msg = Utf8Encode(msg);
       var msg_len = msg.length;
       var word_array = new Array();
       for( i=0; i<msg_len-3; i+=4 ) {
       j = msg.charCodeAt(i)<<24 | msg.charCodeAt(i+1)<<16 |
       msg.charCodeAt(i+2)<<8 | msg.charCodeAt(i+3);
       word_array.push( j );
       }
       switch( msg_len % 4 ) {
       case 0:
       i = 0x080000000;
       break;
       case 1:
       i = msg.charCodeAt(msg_len-1)<<24 | 0x0800000;
       break;
       case 2:
       i = msg.charCodeAt(msg_len-2)<<24 | msg.charCodeAt(msg_len-1)<<16 | 0x08000;
       break;
       case 3:
       i = msg.charCodeAt(msg_len-3)<<24 | msg.charCodeAt(msg_len-2)<<16 | msg.charCodeAt(msg_len-1)<<8 | 0x80;
       break;
       }
       word_array.push( i );
       while( (word_array.length % 16) != 14 ) word_array.push( 0 );
       word_array.push( msg_len>>>29 );
       word_array.push( (msg_len<<3)&0x0ffffffff );
       for ( blockstart=0; blockstart<word_array.length; blockstart+=16 ) {
       for( i=0; i<16; i++ ) W[i] = word_array[blockstart+i];
       for( i=16; i<=79; i++ ) W[i] = rotate_left(W[i-3] ^ W[i-8] ^ W[i-14] ^ W[i-16], 1);
       A = H0;
       B = H1;
       C = H2;
       D = H3;
       E = H4;
       for( i= 0; i<=19; i++ ) {
       temp = (rotate_left(A,5) + ((B&C) | (~B&D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;
       E = D;
       D = C;
       C = rotate_left(B,30);
       B = A;
       A = temp;
       }
       for( i=20; i<=39; i++ ) {
       temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;
       E = D;
       D = C;
       C = rotate_left(B,30);
       B = A;
       A = temp;
       }
       for( i=40; i<=59; i++ ) {
       temp = (rotate_left(A,5) + ((B&C) | (B&D) | (C&D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;
       E = D;
       D = C;
       C = rotate_left(B,30);
       B = A;
       A = temp;
       }
       for( i=60; i<=79; i++ ) {
       temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;
       E = D;
       D = C;
       C = rotate_left(B,30);
       B = A;
       A = temp;
       }
       H0 = (H0 + A) & 0x0ffffffff;
       H1 = (H1 + B) & 0x0ffffffff;
       H2 = (H2 + C) & 0x0ffffffff;
       H3 = (H3 + D) & 0x0ffffffff;
       H4 = (H4 + E) & 0x0ffffffff;
       }
       var temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);

       return temp.toLowerCase();
    }
  </script>

  <script>
    const fileInput = document.getElementById('file-input');
    const imagePreview = document.getElementById('image-preview');
    const instructions = document.getElementById('instructions');
    const uploadLabel = document.getElementById('upload-label');
    const thankYouSection = document.getElementById('thank-you-section');
    const shareButton = document.getElementById('share-button');
    let latestImg;

    // Handle file input change
    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const base64Image = e.target.result;
          imagePreview.src = base64Image;
          imagePreview.style.display = 'block';
          uploadLabel.style.display = 'none';
          instructions.style.display = 'none';
          cloudupload(base64Image);
        };
        reader.readAsDataURL(file);
      }
    });

    // Handle mobile-specific behavior
    uploadLabel.addEventListener('click', (event) => {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        event.preventDefault();
        const userChoice = confirm("Choose an option:\nOK: Capture from Camera\nCancel: Upload from Gallery");
        fileInput.setAttribute('capture', userChoice ? 'camera' : '');
        fileInput.click();
      }
    });

    // Upload to Cloudinary
    function cloudupload(base64data) {
      const form = new FormData();
      form.append('file', base64data);
      form.append('timestamp', Date.now());
      form.append('api_key', '876197288662615');
      form.append('signature', SHA1(`timestamp=${Date.now()}g9QkCO7ACWJuCL7DUBXwE_bfkAw`));

      fetch('https://api.cloudinary.com/v1_1/lalittambi/image/upload', {
        method: 'POST',
        body: form
      })
        .then(response => response.json())
        .then(data => {
          latestImg = data.public_id;
          showThankYouMessage();
        })
        .catch(error => {
          alert("Error uploading image: " + error);
        });
    }

    // Show Thank You message and sharing options
    function showThankYouMessage() {
      const imageUrl = `https://res.cloudinary.com/lalittambi/image/upload/c_thumb,g_face,h_505,w_685/u_sm7selfie_al8izm/fl_layer_apply,g_north_west,x_-455,y_-705/${latestImg}`;
      imagePreview.src = imageUrl;
      thankYouSection.style.display = 'block';
    }

    // Share or download functionality
    shareButton.addEventListener('click', () => {
      const imageUrl = imagePreview.src;
      const isMobile = window.innerWidth <= 768;

      if (isMobile) {
        navigator.share
          ? navigator.share({ url: imageUrl })
          : alert("Sharing not supported on this device.");
      } else {
        const a = document.createElement('a');
        a.href = imageUrl;
        a.download = 'shared-image.jpg';
        a.click();
      }
    });
  </script>
</body>
</html>
